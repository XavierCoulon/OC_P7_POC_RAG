services:
    api:
        build:
            context: .
            dockerfile: Dockerfile
        container_name: rag-api
        ports:
            - "8000:8000"
        environment:
            - MISTRAL_API_KEY=${MISTRAL_API_KEY}
            - API_KEY=${API_KEY}
            - DEBUG=false
        restart: unless-stopped
        volumes:
            - ./data:/app/data
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
            interval: 30s
            timeout: 10s
            retries: 3
            start_period: 5s
        develop:
            watch:
                # Sync the working directory with /app, excluding .venv
                - action: sync
                  path: .
                  target: /app
                  ignore:
                      - .venv/
                # Rebuild on dependency changes
                - action: rebuild
                  path: ./pyproject.toml
                - action: rebuild
                  path: ./uv.lock
